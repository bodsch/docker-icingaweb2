#!/bin/bash

# Custom build for Docker Hub
# see: https://medium.com/microscaling-systems/labelling-automated-builds-on-docker-hub-f3d073fb8e1

[[ -e hooks/environment ]] && . hooks/environment

cat << EOF > .env

BUILD_DATE=${BUILD_DATE}
BUILD_VERSION=${BUILD_VERSION}

ICINGAWEB_VERSION=${ICINGAWEB_VERSION}
INSTALL_THEMES=${INSTALL_THEMES}
INSTALL_MODULES=${INSTALL_MODULES}

MARIADB_SYSTEM_USER=root
MARIADB_ROOT_PASSWORD=vYUQ14SGVrJRi69PsujC
MYSQL_ROOT_PASS=vYUQ14SGVrJRi69PsujC
IDO_PASSWORD=qUVuLTk9oEDUV0A
ICINGAWEB_DIRECTOR=${ICINGAWEB_DIRECTOR:-false}

XDEBUG_ENABLED=true

# grafana
URL_PATH=/grafana
LOG_LEVEL=info
ROUTER_LOGGING=false

GRAFANA_HOST=grafana
GRAFANA_PORT=3000
GRAFANA_AUTHENTICATION=token
GRAFANA_TOKEN=
GRAFANA_ENABLE_LINK="yes"
GRAFANA_SHOW_DEBUG="0"
GRAFANA_PUBLIC="yes"
GRAFANA_PUBLIC_HOST=localhost/grafana
GRAFANA_PUBLIC_PROTOCOL=https
GRAFANA_THEME=light

GRAFANA_DASHBOARD_UID=icinga2-default


GRAFANA_PUBLIC_HTTP_PATH=/grafana

EOF

docker-compose \
  --file compose/head.yml \
  --file compose/nginx.yml \
  --file compose/grafana.yml \
  --file compose/database.yml \
  --file compose/graphite.yml \
  --file compose/icingaweb2.yml \
  --file compose/master.yml \
  config > docker-compose.yml
